<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dua Play Cards</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Softer light blue-grey background for the page */
            display: flex;
            flex-direction: column; /* Changed to column to stack heading and sections */
            justify-content: flex-start;
            align-items: center; /* Center horizontally */
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .app-header {
            width: 100%;
            max-width: 1200px;
            text-align: center;
            margin-bottom: 30px; /* Space below heading */
        }
        .app-header h1 {
            font-size: 3rem; /* Larger heading */
            font-weight: 900; /* Extra bold */
            color: #2c3e50; /* Dark prominent color */
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1); /* More pronounced shadow */
        }
        .app-header .current-date {
            font-size: 1.25rem; /* Text-xl equivalent */
            font-weight: 600; /* Semi-bold */
            color: #526d88; /* Slightly darker grey for date */
            margin-bottom: 5px; /* Reduced space below date */
        }
        .app-header .header-current-time { /* New class for current time in header */
            font-size: 1.25rem; /* Same size as date */
            font-weight: 600;
            color: #526d88;
            margin-bottom: 15px; /* Space below current time */
        }
        .app-header hr {
            border: none;
            height: 3px; /* Thicker line */
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, #a4b0be 50%, rgba(255,255,255,0) 100%); /* Gradient line */
            margin: 20px auto;
            width: 80%; /* Shorter line */
            max-width: 600px;
        }

        /* New Wrapper for Next Prayer and Quran Quote Sections */
        .top-sections-wrapper {
            display: flex;
            flex-wrap: wrap; /* Allows sections to wrap onto next line on smaller screens */
            justify-content: center; /* Center items when they wrap */
            align-items: stretch; /* Make items stretch to the same height */
            width: 100%;
            max-width: 1200px; /* Same max-width as app-header */
            gap: 20px; /* Gap between the two sections */
            margin-bottom: 40px; /* Space between this wrapper and the card container */
            padding: 0 20px; /* Add some horizontal padding for smaller screens */
            box-sizing: border-box;
        }

        /* Next Prayer Section Styles */
        .next-prayer-section {
            flex: 0 0 280px; /* Fixed width for the next prayer section */
            max-width: 100%; /* Ensure it doesn't overflow on small screens */
            background-color: #f7f7f7; /* Default fallback */
            background-size: 200% 200%; /* For gradient animation */
            animation: gradient-shift 10s ease infinite alternate; /* Subtle animation */
            border-radius: 16px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            padding: 15px; /* Adjusted padding to reduce overall height and gap */
            text-align: center;
            border: 1px solid #e0e0e0;
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            display: flex; /* Use flex to center content vertically */
            flex-direction: column; /* Stack contents */
            align-items: center; /* Center items horizontally */
            justify-content: center; /* Center items vertically */
        }

        .next-prayer-section canvas {
            margin-top: 5px; /* Adjusted margin */
            margin-bottom: 5px; /* Small gap between canvas and text below */
        }
        /* Removed .next-prayer-name-display styles as the div is removed */


        /* Quran Quote Section Styles */
        .quran-quote-section {
            flex-grow: 1; /* Allows it to take up remaining space */
            min-width: 300px; /* Ensure it has a minimum width before wrapping */
            max-width: 100%; /* Ensure it doesn't overflow on small screens */
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 25px 30px;
            text-align: center;
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            display: flex; /* Make it a flex container to center its content if stretched */
            flex-direction: column; /* Stack content vertically */
            justify-content: center; /* Center content vertically */
            align-items: center; /* Center content horizontally */
        }
        .quran-quote-section .quote-arabic {
            font-family: 'Scheherazade New', serif; /* Changed Arabic font */
            font-size: 1.8rem; /* Large font size for Arabic */
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px; /* Reduced space below Arabic */
            line-height: 1.6;
        }
        .quran-quote-section .quote-pronunciation { /* New style for pronunciation */
            font-size: 1.1rem; /* Increased font size for visibility */
            color: #34495e; /* Darker color for better contrast */
            font-style: normal; /* Remove italic for more prominence */
            font-weight: 500; /* Medium bold */
            margin-bottom: 10px; /* Space below pronunciation */
        }
        .quran-quote-section .quote-english {
            font-size: 1.1rem; /* Slightly larger for English translation */
            color: #34495e;
            font-style: italic;
            line-height: 1.5;
            margin-top: 10px; /* Space between Arabic and English */
        }
        .quran-quote-section .quote-details {
            font-size: 0.85rem; /* Smaller font for details */
            color: #607d8b; /* Lighter grey for details */
            margin-top: 5px; /* Small space below English */
        }
        .quran-quote-section .quote-bangla {
            font-family: 'Noto Sans Bengali', sans-serif; /* Bengali font */
            font-size: 1.05rem; /* Slightly smaller than English, clear for Bengali */
            color: #4a6572; /* Slightly darker grey for Bengali */
            line-height: 1.5;
            margin-top: 10px; /* Space between English and Bengali */
        }

        /* Prayer Times Section Specific Styles */
        .prayer-times-section {
            background-color: transparent;
            box-shadow: none;
            padding: 0;
            margin-top: 60px; /* Gap from cards above */
            margin-bottom: 40px; /* Gap from page bottom */
            width: 100%; /* Ensure it takes full width within the main content area */
            max-width: 800px; /* Max width as before */
        }
        .prayer-times-section h2 {
            font-size: 2rem;
            font-weight: 800;
            color: #2c3e50;
            margin-bottom: 25px;
        }
        .location-input-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .location-input-group input[type="text"] {
            flex-grow: 1;
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            max-width: 300px;
        }
        .location-input-group button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
        }
        .location-input-group button:hover {
            background-color: #2980b9;
        }
        .prayer-times-display {
            margin-top: 20px;
            text-align: left;
            width: 100%;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        .prayer-times-display h3 { /* Style for "All Times for [Location]" */
            padding-top: 15px; /* Added padding here */
            text-align: center;
            font-size: 1.25rem;
            color: #2c3e50;
        }
        .prayer-times-display table {
            width: 100%;
            border-collapse: collapse;
        }
        .prayer-times-display th, .prayer-times-display td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        .prayer-times-display th {
            background-color: #f8f8f8;
            font-weight: 700;
            color: #333;
        }
        .prayer-times-display td {
            color: #555;
        }
        .prayer-times-display tr:last-child td {
            border-bottom: none;
        }
        .loading-indicator {
            color: #3498db;
            font-weight: 500;
            margin-top: 10px;
        }
        .error-message {
            color: #e74c3c;
            font-weight: 500;
            margin-top: 10px;
        }

        /* Card Container (for grid layout) */
        .card-container {
            display: grid;
            gap: 20px; /* Consistent gap between cards */
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Adjusted min-width for better fit */
            max-width: 1200px; /* Maintain overall max width */
            width: 100%; /* Take full width of parent */
            margin-bottom: 60px; /* Gap before prayer section */
            padding: 0 20px; /* Consistent padding with top-sections-wrapper */
            box-sizing: border-box;
        }
        .card {
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            padding: 15px; /* Adjusted padding to make card smaller */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            background-size: 200% 200%;
            animation: gradient-shift 10s ease infinite alternate;
            cursor: pointer; /* Indicate clickable */

            /* Flip specific styles */
            perspective: 1000px; /* For 3D effect */
            height: 250px; /* Adjusted fixed height for consistent card sizing */
            position: relative; /* For inner positioning */
        }
        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Hide back of the element when flipped */
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center; /* Center content vertically within face */
            align-items: center; /* Center content horizontally within face */
            padding: 10px; /* Further reduced internal padding for card faces */
            box-sizing: border-box;
            border-radius: inherit; /* Inherit border-radius from parent .card */
        }

        .card-front {
            background: inherit; /* Inherit gradient background */
            color: #333;
            z-index: 2;
        }

        .card-back {
            background: inherit; /* Inherit gradient background */
            color: #333;
            transform: rotateY(180deg);
            z-index: 1; /* Lower z-index initially */
            overflow-y: auto; /* Allow scrolling for long duas */
            text-align: left; /* Default text align for back content */
        }

        .card-back p {
            margin-bottom: 5px; /* Adjusted margin for back content */
            line-height: 1.4; /* Slightly tighter line height */
        }
        .card-back strong {
            color: #000;
        }
        .card-back .card-title { /* Style for title on back */
            font-size: 1.1rem; /* Smaller title on back */
            margin-bottom: 10px;
        }
        .card-back .text-arabic {
            font-size: 1.8rem; /* Adjusted Arabic font size for back */
            margin: 10px 0;
        }
        .card-back .quote-pronunciation,
        .modal-card-content .quote-pronunciation {
            font-size: 0.9rem; /* Adjusted pronunciation font size for back and modal */
            margin-bottom: 5px;
        }
        .card-back .quote-english,
        .modal-card-content .quote-english {
            font-size: 0.95rem; /* Adjusted English font size for back and modal */
            margin-top: 5px;
        }
        .card-back .text-sm,
        .modal-card-content .text-sm {
            font-size: 0.75rem; /* Adjusted small text size */
        }


        /* Modal Overlay for Pop-up Effect */
        .modal-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Dark overlay */
            z-index: 1000; /* High z-index to cover everything */
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-card {
            background: #ffffff; /* White background for the modal */
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 600px; /* Max width for the popped-up card */
            width: 90%; /* Responsive width */
            max-height: 90%; /* Responsive height */
            position: relative;
            transform: scale(0.8); /* Start smaller */
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Ensure content stays within borders */
        }

        .modal-overlay.active .modal-card {
            transform: scale(1); /* Scale to full size */
            opacity: 1;
        }

        .modal-card-content {
            padding: 30px;
            overflow-y: auto; /* Allow scrolling inside the modal content */
            flex-grow: 1;
        }

        .modal-close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #333;
            cursor: pointer;
            z-index: 10;
            transition: color 0.2s ease;
        }
        .modal-close-button:hover {
            color: #e74c3c;
        }

        /* Text styles for inside the modal card (similar to .card-back) */
        .modal-card-content .card-title {
            font-weight: 800;
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 18px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.05);
            text-align: center;
        }
        .modal-card-content p {
            margin-bottom: 14px;
            line-height: 1.7;
            color: #34495e;
            text-align: left; /* Ensure text alignment within modal */
        }
        .modal-card-content strong {
            color: #1a2c3c;
        }
        .modal-card-content .text-arabic {
            font-family: 'Scheherazade New', serif;
            text-align: right;
            font-size: 2.5rem;
            font-weight: bold;
            margin: 20px 0;
            color: #1c2c3c;
            line-height: 1.8;
        }
        
        .modal-card-content .quote-details {
            font-size: 0.85rem;
            color: #607d8b;
            margin-top: 5px;
            text-align: left;
        }
        .modal-card-content .quote-bangla {
            font-family: 'Noto Sans Bengali', sans-serif;
            font-size: 1.05rem;
            color: #4a6572;
            line-height: 1.5;
            margin-top: 10px;
            text-align: left;
        }


        /* Keyframes for subtle gradient animation */
        @keyframes gradient-shift {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            .top-sections-wrapper {
                flex-direction: column; /* Stack vertically on smaller screens */
                align-items: center; /* Center items when stacked */
            }
            .next-prayer-section,
            .quran-quote-section {
                flex: 0 0 auto; /* Allow auto width */
                width: 100%; /* Take full width */
                max-width: 450px; /* Limit max width for readability */
                margin-bottom: 20px; /* Space between stacked sections */
            }
            .card-container {
                padding: 0 10px; /* Adjusted padding for smaller screens */
            }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&family=Noto+Sans+Bengali:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-header">
        <h1>DAILY DUAS</h1>
        <div id="currentDate" class="current-date"></div>
        <div id="headerCurrentTime" class="header-current-time"></div>
        <hr>
    </div>

    <div class="top-sections-wrapper">
        <div class="next-prayer-section" id="nextPrayerSection">
            <canvas id="countdownCanvas" width="180" height="180"></canvas>
            <div id="nextPrayerNameDisplay" class="next-prayer-name-display"></div>
        </div>

        <div class="quran-quote-section">
            <div class="quote-arabic" id="quranQuoteArabic"></div>
            <div class="quote-pronunciation" id="quranQuotePronunciation"></div>
            <div class="quote-english" id="quranQuoteEnglish"></div>
            <div class="quote-details" id="quranQuoteDetails"></div>
            <div class="quote-bangla" id="quranQuoteBangla"></div>
        </div>
    </div>

    <!-- The original card-container now houses the grid of flip cards -->
    <div class="card-container" id="duaCardsContainer"></div>

    <!-- Modal Overlay for popped-up cards -->
    <div class="modal-overlay" id="cardModalOverlay">
        <div class="modal-card" id="cardModal">
            <button class="modal-close-button" id="modalCloseBtn">&times;</button>
            <div class="modal-card-content" id="modalCardContent">
                <!-- Flipped card content will be loaded here -->
            </div>
        </div>
    </div>

    <div class="prayer-times-section">
        <h2>Daily Prayer Times</h2>
        <div class="location-input-group">
            <button id="getLocationBtn">Refresh Location & Times</button>
        </div>
        <div id="prayerTimesLoading" class="loading-indicator hidden">Fetching prayer times...</div>
        <div id="prayerTimesError" class="error-message hidden"></div>
        <div class="prayer-times-display" id="prayerTimesDisplay">
        </div>
    </div>

    <script>
        // --- Date Display Logic ---
        function displayCurrentDate() {
            const dateElement = document.getElementById('currentDate');
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const today = new Date();
            dateElement.textContent = today.toLocaleDateString('en-US', options);
        }
        displayCurrentDate();

        // --- Current Time in Header Logic ---
        const headerCurrentTimeElem = document.getElementById('headerCurrentTime');
        function updateHeaderCurrentTime() {
            const now = new Date();
            headerCurrentTimeElem.textContent = `Current Time: ${formatTime(now)}`;
        }
        setInterval(updateHeaderCurrentTime, 1000); // Update every second
        updateHeaderCurrentTime(); // Initial call


        // --- Quran Quote Logic ---
        const quranQuotes = [
            {
                arabic: "إِنَّ مَعَ الْعُسْرِ يُسْرًا",
                pronunciation: "Inna maAAa alAAusri yusra",
                english: "Indeed, with hardship [will be] ease.",
                bangla: "নিশ্চয়ই কষ্টের পর স্বস্তি আসে।",
                details: "Surah Al-Inshirah (94:6)"
            },
            {
                arabic: "وَعَسَىٰ أَن تَكْرَهُوا شَيْئًا وَهُوَ خَيْرٌ לَّكُمْ",
                pronunciation: "WaAAasa an takrahoo shayan wahuwa khayrun lakum",
                english: "But perhaps you hate a thing and it is good for you.",
                bangla: "হতে পারে তোমরা কোনো কিছুকে অপছন্দ করো অথচ তা তোমাদের জন্য কল্যাণকর।",
                details: "Surah Al-Baqarah (2:216)"
            },
            {
                arabic: "פَاذْכְּרוּנִי אָזְכְּרְכֶם וְהַשְׂכְּרוּ לִי וְלָא תִּקְפְּרוּנִי",
                english: "So remember Me; I will remember you. And be grateful to Me and do not deny Me.",
                bangla: "অতএব তোমরা আমাকে স্মরণ করো, আমিও তোমাদের স্মরণ করব। আর আমার প্রতি কৃতজ্ঞ হও এবং অস্বীকার করো না।",
                details: "Surah Al-Baqarah (2:152)"
            },
            {
                arabic: "וְלָא תֵּיאָסוּ מִן רَّוְחִ اللَّهِ",
                pronunciation: "Wa laa tayasoo min rawhi Allahi",
                english: "And never give up hope of Allah's mercy.",
                bangla: "আর আল্লাহর রহমত থেকে নিরাশ হয়ো না।",
                details: "Surah Yusuf (12:87)"
            },
            {
                arabic: "إِنَّ اللَّهَ يُחִבُّ الْمُتَوَקِّلِينَ",
                pronunciation: "Inna Allaha yuhibbu almutawakkileena",
                english: "Indeed, Allah loves those who rely [upon Him].",
                bangla: "নিশ্চয়ই আল্লাহ তাদের ভালোবাসেন যারা তাঁর উপর ভরসা করে।",
                details: "Surah Ali 'Imran (3:159)"
            },
            {
                arabic: "לָא يُקַלِّףُ اللَّهُ נَفְסًا إِلَّا וُסְעָהָא",
                english: "Allah does not charge a soul except [with that within] its capacity.",
                bangla: "আল্লাহ কোন ব্যক্তিকে তার সাধ্যের বাইরে কষ্ট দেন না।",
                details: "Surah Al-Baqarah (2:286)"
            },
            {
                arabic: "ادْعُונִי أَסְתָגִבְ לְכֶם",
                english: "Call upon Me; I will respond to you.",
                bangla: "তোমরা আমাকে ডাকো, আমি তোমাদের ডাকে সাড়া দেব।",
                details: "Surah Ghafir (40:60)"
            }
        ];

        function displayRandomQuranQuote() {
            const quoteArabicElement = document.getElementById('quranQuoteArabic');
            const quotePronunciationElement = document.getElementById('quranQuotePronunciation');
            const quoteEnglishElement = document.getElementById('quranQuoteEnglish'); /* Corrected ID */
            const quoteDetailsElement = document.getElementById('quranQuoteDetails');   /* Corrected ID */
            const quoteBanglaElement = document.getElementById('quranQuoteBangla');     /* Corrected ID */

            const randomIndex = Math.floor(Math.random() * quranQuotes.length);
            const randomQuote = quranQuotes[randomIndex];

            quoteArabicElement.textContent = randomQuote.arabic;
            // Ensure quotePronunciationElement exists before setting textContent
            if (quotePronunciationElement) {
                quotePronunciationElement.textContent = randomQuote.pronunciation; // Set pronunciation
            }
            // Ensure elements exist before setting textContent
            if (quoteEnglishElement) {
                quoteEnglishElement.textContent = `"${randomQuote.english}"`;
            }
            if (quoteDetailsElement) {
                quoteDetailsElement.textContent = randomQuote.details;
            }
            if (quoteBanglaElement) {
                quoteBanglaElement.textContent = `(${randomQuote.bangla})`;
            }
        }
        displayRandomQuranQuote();

        // --- Dua Cards Logic ---
        const duas = [
            {
                title: "Dua Card 1",
                dua: "Read Surah Kahf on Friday.",
                benefit: "To have noor in face for an entire week."
            },
            {
                title: "Dua Card 2",
                dua: "Rabbanaa atmim lana noorana waghfir lana innaka 'alaa kulli shay-in qadeer.",
                note: "(One of my everyday skin care tip)",
                benefit: "For instant noor in your face!"
            },
            {
                title: "Dua Card 3",
                dua: "Pray 2 rakats of istikhara when ever u want Allah's suggestion on making simple to complex decisions like for marriage ask if he/she is the right guy/girl, jobs etc. He might show u a dream or guide your mind without you noticing. It may take 1 day or a week to work. Keep patience and trust.",
                benefit: "For guidance in decision-making (e.g., marriage, jobs)."
            },
            {
                title: "Dua Card 4",
                dua: "Recite Ayatal kursi after every farj namaj.", // Removed the specific Ayatul Kursi text
                benefit: "To guarantee Jannah."
            },
            {
                title: "Dua Card 5",
                dua: "Recite this dua after perfecting your wadu. You can do wudu for no reason and recite it. It will guarantee you Jannah.",
                duaArabic: "أشهد أن لا إله إلا الله وحده لا شريك له وأشҳоd أن محمداً عبده ورسوله.",
                benefit: "To guarantee Jannah."
            },
            {
                title: "Dua Card 6",
                dua: "Reciting surah ikhlas.", // Omitted Qul huwal laahu ahad ... Wa lam yakul-lahoo kufuwan ahad
                benefit: "Is equal to reading 1/3rd of the Quran. Therefore, reciting it 3x will give u equal reward of reading the whole Quran."
            },
            {
                title: "Dua Card 7",
                dua: "Recite \"Allahumma inni as'aluk jannata wa'awuzu bika minan-nar\" 6 times. And \"Allahumma ajirni min an-nar\" 7 times a day after prayer.",
                benefit: "To protect yourself from hellfire (especially after fajr, magrib, and isha)."
            },
            {
                title: "Dua Card 8",
                dua: "Read Surah Mulk before sleeping.",
                benefit: "To save yourself from the punishments of graves."
            },
            {
                title: "Dua Card 9",
                benefit: "To get your sins forgiven even if u have a lot of them."
            },
            {
                title: "Dua Card 10",
                dua: "Recite dua before sleeping.",
                benefit: "If you die in sleep, you will be considered as a person with wadu and will be rewarded."
            },
            {
                title: "Dua Card 11", // Renamed from Card 12
                dua: "Qul a'udhu bi-Rabbil-falaq , Min sharri ma khalaq , Wa min sharri ghasiqin idha waqab , Wa min sharrin-naffathati fil ' uqad , Wa min sharrin-hasidin idha hasad .",
                benefit: "Protection from evil of creation, darkness, magic, and envy."
            },
            {
                title: "Dua Card 12", // Renamed from Card 13
                dua: "Qul a'udhu bi-Rabbin-nas , Malikin-nas , Ilahin-nas , Min sharril-waswasil-khannas , Alladhi yuwaswisu fi sudurin-nas , Minal-jinnati wan-nas .",
                benefit: "Protection from the evil whispers of jinn and mankind."
            },
            {
                title: "Dua Card 13", // Renamed from Card 15
                dua: "Bismillahil-ladhi la yadurru ma'asmihi shay'un fil-ardi wa la fis-sama'i wa Huwas-Sami'ul-'Aleem .",
                note: "(Say 3 times in morning and evening)",
                benefit: "Protection from harm on earth and in the sky with Allah's name."
            },
            {
                title: "Dua Card 14", // Renamed from Card 16
                dua: "A'udhu bikalimatillahit-tammati min sharri ma khalaq , wa dhara'a wa bara'a .",
                note: "(Anytime , especially in fear or uncertainty)",
                benefit: "Seeking complete refuge in Allah's words from evil, creation, and what He originated."
            },
            {
                title: "Dua Card 15", // Renamed from Card 17
                dua: "Bismika Allahumma amutu wa ahya .",
                note: "(Before Sleeping)",
                benefit: "Invoking Allah's name before sleeping and waking."
            },
            {
                title: "Dua Card 16", // Renamed from Card 18
                dua: "A'udhu bikalimatillahit-tammati min ghada bihima wa sharri ' ibadihi wa min hamazatish-shayateeni wa an yahdurun .",
                note: "(in Fear)",
                benefit: "Seeking refuge from Allah's anger, evil of His servants, and whispers of devils."
            },
            {
                title: "Dua Card 17", // Renamed from Card 19
                dua: "U'idhu-ka bi-kalimati-llah-it-tammah min kulli shaytanin wa hammah wa min kulli ' aynin lammah .",
                note: "(For children , loved ones , or yourself)",
                benefit: "Seeking protection for oneself or loved ones from every devil, harmful thing, and evil eye."
            }
        ];

        const duaCardsContainer = document.getElementById('duaCardsContainer');
        const pastelGradients = [
            'linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%)', // Soft Purple
            'linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)', // Gentle Green
            'linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)', // Warm Orange
            'linear-gradient(135deg, #e1f5fe 0%, #bbdefb 100%)', // Cool Blue
            'linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%)', // Blush Pink
            'linear-gradient(135deg, #efebe9 0%, #d7ccc8 100%)',  // Muted Grey/Brown
            'linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%)', // Light Grey Blue
            'linear-gradient(135deg, #e6f7ff 0%, #bae7ff 100%)', // Sky Blue
            'linear-gradient(135deg, #ffe0e0 0%, #ffc0c0 100%)'  // Light Red/Coral
        ];

        // --- Card Creation and Interaction Logic ---
        const cardModalOverlay = document.getElementById('cardModalOverlay');
        const cardModal = document.getElementById('cardModal');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const modalCardContent = document.getElementById('modalCardContent');

        duas.forEach((duaData, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('tabindex', '0');
            card.style.backgroundImage = pastelGradients[index % pastelGradients.length];

            const cardInner = document.createElement('div');
            cardInner.className = 'card-inner';

            const cardFront = document.createElement('div');
            cardFront.className = 'card-front';
            cardFront.style.backgroundImage = pastelGradients[index % pastelGradients.length]; // Apply background to front

            const cardBack = document.createElement('div');
            cardBack.className = 'card-back';
            cardBack.style.backgroundImage = pastelGradients[index % pastelGradients.length]; // Apply background to back

            // Populate Card Front (Dua Number and Benefit)
            const frontTitle = document.createElement('h3');
            frontTitle.className = 'card-title';
            frontTitle.textContent = duaData.title;
            cardFront.appendChild(frontTitle);

            const frontBenefit = document.createElement('p');
            frontBenefit.innerHTML = `<strong>Benefit:</strong> ${duaData.benefit}`;
            frontBenefit.style.textAlign = 'center';
            cardFront.appendChild(frontBenefit);

            // Populate Card Back (Full Dua details)
            const backTitle = document.createElement('h3');
            backTitle.className = 'card-title';
            backTitle.textContent = duaData.title;
            cardBack.appendChild(backTitle);

            const backDua = document.createElement('p');
            backDua.innerHTML = `<strong>Dua: ${duaData.dua}</strong>`;
            backDua.style.textAlign = 'center';
            backDua.style.marginBottom = '15px';
            cardBack.appendChild(backDua);

            if (duaData.note) {
                const backNote = document.createElement('p');
                backNote.innerHTML = `<span class="text-sm italic text-gray-600">${duaData.note}</span>`;
                cardBack.appendChild(backNote);
            }

            if (duaData.duaArabic) {
                const backArabicDua = document.createElement('p');
                backArabicDua.className = 'text-arabic';
                backArabicDua.innerHTML = `<strong>${duaData.duaArabic}</strong>`;
                cardBack.appendChild(backArabicDua);
            }

            if (duaData.pronunciation) { // Add pronunciation to back
                const backPronunciation = document.createElement('p');
                backPronunciation.className = 'quote-pronunciation'; /* Use existing style */
                backPronunciation.textContent = duaData.pronunciation;
                cardBack.appendChild(backPronunciation);
            }


            const backBenefit = document.createElement('p');
            backBenefit.innerHTML = `<strong>Benefit:</strong> ${duaData.benefit}`;
            cardBack.appendChild(backBenefit);


            cardInner.appendChild(cardFront);
            cardInner.appendChild(cardBack);
            card.appendChild(cardInner);
            duaCardsContainer.appendChild(card);

            card.addEventListener('click', () => {
                // Populate modal with back content
                modalCardContent.innerHTML = ''; // Clear previous content
                // Clone children of cardBack to modal content
                Array.from(cardBack.children).forEach(child => {
                    modalCardContent.appendChild(child.cloneNode(true));
                });

                // Apply background to modal card
                cardModal.style.backgroundImage = card.style.backgroundImage;

                cardModalOverlay.classList.add('active'); // Show overlay
                document.body.style.overflow = 'hidden'; // Prevent scrolling background
            });
        });

        modalCloseBtn.addEventListener('click', () => {
            cardModalOverlay.classList.remove('active'); // Hide overlay
            document.body.style.overflow = ''; // Restore scrolling
            modalCardContent.innerHTML = ''; // Clear modal content
        });

        // Close modal if clicking outside the card itself
        cardModalOverlay.addEventListener('click', (event) => {
            if (event.target === cardModalOverlay) {
                cardModalOverlay.classList.remove('active');
                document.body.style.overflow = '';
                modalCardContent.innerHTML = '';
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && cardModalOverlay.classList.contains('active')) {
                cardModalOverlay.classList.remove('active');
                document.body.style.overflow = '';
                modalCardContent.innerHTML = '';
            }
        });


        // --- Prayer Times Logic ---
        const prayerTimesLoading = document.getElementById('prayerTimesLoading');
        const prayerTimesError = document.getElementById('prayerTimesError');
        const prayerTimesDisplay = document.getElementById('prayerTimesDisplay');

        // Elements for next prayer section
        const nextPrayerSectionElem = document.getElementById('nextPrayerSection');
        const nextPrayerNameDisplay = document.getElementById('nextPrayerNameDisplay'); 

        const PRAYER_TIMES_API_URL = 'https://api.aladhan.com/v1/timingsByCity';

        let countdownInterval; // To store the interval ID for clearing

        // Canvas elements for countdown circle
        let countdownCanvas;
        let ctx;
        const CANVAS_SIZE = 150; // Size of the square canvas
        const LINE_WIDTH = 10;
        const RADIUS = (CANVAS_SIZE / 2) - (LINE_WIDTH / 2); // Radius of the arc

        // Function to format time (e.g., 01:02:03 PM)
        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
        }

        // Function to calculate and format time left (HH:MM:SS)
        function calculateTimeLeft(targetTime) {
            const now = new Date();
            const diffMs = targetTime.getTime() - now.getTime();

            if (diffMs < 0) {
                return "00:00:00"; // All time passed
            }

            const diffSeconds = Math.floor(diffMs / 1000);
            const hours = Math.floor(diffSeconds / 3600);
            const minutes = Math.floor((diffSeconds % 3600) / 60);
            const seconds = diffSeconds % 60;

            const formattedHours = String(hours).padStart(2, '0');
            const formattedMinutes = String(minutes).padStart(2, '0');
            const formattedSeconds = String(seconds).padStart(2, '0');

            return `${formattedHours}:${formattedMinutes}:${formattedSeconds}`;
        }

        // Function to draw the circular countdown on canvas
        function drawCountdownCircle(remainingSeconds, totalDurationForArc, timeLeftFormatted) {
            if (!ctx) return;

            ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE); // Clear the canvas

            const centerX = CANVAS_SIZE / 2;
            const centerY = CANVAS_SIZE / 2;

            // Draw outer static circle (background of the progress bar)
            ctx.beginPath();
            ctx.arc(centerX, centerY, RADIUS, 0, 2 * Math.PI);
            ctx.lineWidth = LINE_WIDTH;
            ctx.strokeStyle = '#e0e0e0'; // Light grey background for the circle
            ctx.stroke();

            // Draw the progress arc
            if (totalDurationForArc > 0 && remainingSeconds >= 0) {
                const progressPercentage = remainingSeconds / totalDurationForArc;
                const startAngle = -Math.PI / 2; // Start from top (12 o'clock)
                const endAngle = startAngle + (2 * Math.PI * progressPercentage);

                ctx.beginPath();
                ctx.arc(centerX, centerY, RADIUS, startAngle, endAngle);
                ctx.lineWidth = LINE_WIDTH;
                ctx.lineCap = 'round'; // Round caps for the arc ends
                ctx.strokeStyle = '#27ae60'; // Green for the progress
                ctx.stroke();
            }

            // Draw "TIME LEFT" label
            ctx.font = 'bold 13px "Inter", sans-serif';
            ctx.fillStyle = '#34495e';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('TIME LEFT', centerX, centerY - 15);


            // Draw the actual time left (HH:MM:SS)
            ctx.font = 'bold 18px "Inter", sans-serif'; /* Slightly smaller to fit HH:MM:SS */
            ctx.fillStyle = '#e67e22';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(timeLeftFormatted, centerX, centerY + 5);
        }


        function updateNextPrayerAndCountdown(timings, timezone, locationName) {
            clearInterval(countdownInterval); // Clear any existing interval

            const prayerOrder = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            let nextPrayer = null;
            let nextPrayerTimeStr = null;
            let nextPrayerDateTime = null;
            let previousPrayerDateTime = null; // To calculate the full interval duration

            const now = new Date();
            const todayDateString = now.toISOString().slice(0, 10); //YYYY-MM-DD

            for (let i = 0; i < prayerOrder.length; i++) {
                const pName = prayerOrder[i];
                const timeString = timings[pName];
                const prayerDateTime = new Date(`${todayDateString}T${timeString}:00`);

                if (prayerDateTime > now) {
                    nextPrayer = pName;
                    nextPrayerTimeStr = timeString;
                    nextPrayerDateTime = prayerDateTime;

                    if (i > 0) {
                        const prevTimeStr = timings[prayerOrder[i-1]];
                        previousPrayerDateTime = new Date(`${todayDateString}T${prevTimeStr}:00`);
                    } else {
                        // If the next prayer is Fajr, the previous one is Isha of the previous day.
                        // For simplicity in arc calculation for the very first interval, we'll set previousPrayerDateTime to now.
                        // A more robust solution would fetch yesterday's Isha.
                        previousPrayerDateTime = now;
                    }
                    break;
                }
            }

            // Handle case where all prayers for today have passed (next is Fajr tomorrow)
            if (!nextPrayer && timings.Fajr) {
                const tomorrow = new Date(now);
                tomorrow.setDate(now.getDate() + 1);
                const tomorrowDateString = tomorrow.toISOString().slice(0, 10);
                nextPrayerDateTime = new Date(`${tomorrowDateString}T${timings.Fajr}:00`);
                nextPrayer = 'Fajr (Tomorrow)';
                nextPrayerTimeStr = timings.Fajr;
                // For this case, the previous prayer starts with today's Isha.
                previousPrayerDateTime = new Date(`${todayDateString}T${timings.Isha}:00`);
            }

            if (nextPrayer) {
                const initialTotalDurationSeconds = (nextPrayerDateTime.getTime() - previousPrayerDateTime.getTime()) / 1000;

                // Update countdown every second and draw on canvas
                countdownInterval = setInterval(() => {
                    const current = new Date();
                    const remainingMs = nextPrayerDateTime.getTime() - current.getTime();
                    const remainingSeconds = Math.max(0, Math.floor(remainingMs / 1000)); // Ensure not negative

                    const timeLeftFormatted = calculateTimeLeft(nextPrayerDateTime); // Use updated format

                    // Draw the circle with updated progress
                    drawCountdownCircle(remainingSeconds, initialTotalDurationSeconds, timeLeftFormatted);
                    
                    // Update the next prayer name display div
                    if (nextPrayerNameDisplay) { // Check if element exists before setting text
                        nextPrayerNameDisplay.textContent = `${nextPrayer} ${nextPrayerTimeStr}`;
                    }

                    // If the countdown passes, re-fetch prayer times to get the *new* next prayer
                    if (remainingSeconds === 0) {
                        clearInterval(countdownInterval);
                        getUserLocation(); // Use getUserLocation to re-fetch and update
                    }
                }, 1000);

                nextPrayerSectionElem.style.display = 'flex'; // Use flex to center canvas content
            } else {
                // If no prayer is found, display N/A or a default state on canvas
                clearInterval(countdownInterval);
                drawCountdownCircle(0, 1, "00:00:00"); // Draw empty circle
                if (nextPrayerNameDisplay) { // Check if element exists before setting text
                    nextPrayerNameDisplay.textContent = "N/A"; // Set N/A for prayer name
                }
                nextPrayerSectionElem.style.display = 'flex'; // Keep flex to show empty state if desired
            }
        }

        async function getPrayerTimes(city = 'Dhaka', country = '') { // Default city parameter
            prayerTimesLoading.classList.remove('hidden');
            prayerTimesError.classList.add('hidden');
            prayerTimesDisplay.innerHTML = '';
            nextPrayerSectionElem.style.display = 'none'; // Hide next prayer while loading
            clearInterval(countdownInterval); // Clear interval on new fetch

            try {
                let url;
                // If using city, always use provided city and default country
                url = `${PRAYER_TIMES_API_URL}?city=${city}&country=Bangladesh&method=11&madhab=2`;

                const response = await fetch(url);
                const data = await response.json();

                if (data.code === 200 && data.status === 'OK') {
                    const timezoneParts = data.data.meta.timezone.split('/');
                    const locationName = timezoneParts[1] || timezoneParts[0]; // Extract city from timezone for display
                    displayPrayerTimesTable(data.data.timings, locationName);
                    updateNextPrayerAndCountdown(data.data.timings, data.data.meta.timezone, locationName);
                } else {
                    prayerTimesError.textContent = `Error fetching prayer times: ${data.status || 'Unknown error'}. Please check your default city configuration.`;
                    prayerTimesError.classList.remove('hidden');
                    nextPrayerSectionElem.style.display = 'none';
                }
            } catch (error) {
                console.error('Failed to fetch prayer times:', error);
                prayerTimesError.textContent = 'Failed to fetch prayer times. Please check your internet connection or try again later.';
                prayerTimesError.classList.remove('hidden');
                nextPrayerSectionElem.style.display = 'none';
            } finally {
                prayerTimesLoading.classList.add('hidden');
            }
        }

        function displayPrayerTimesTable(timings, locationName) {
            let html = `
                <h3 class="text-xl font-semibold text-center mb-4">All Times for ${locationName}</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Prayer</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Fajr</td><td>${timings.Fajr}</td></tr>
                        <tr><td>Sunrise</td><td>${timings.Sunrise}</td></tr>
                        <tr><td>Dhuhr</td><td>${timings.Dhuhr}</td></tr>
                        <tr><td>Asr</td><td>${timings.Asr}</td></tr>
                        <tr><td>Maghrib</td><td>${timings.Maghrib}</td></tr>
                        <tr><td>Isha</td><td>${timings.Isha}</td></tr>
                    </tbody>
                </table>
            `;
            prayerTimesDisplay.innerHTML = html;
        }

        function getUserLocation() {
            prayerTimesLoading.classList.remove('hidden');
            prayerTimesError.classList.add('hidden');
            prayerTimesDisplay.innerHTML = '';
            nextPrayerSectionElem.style.display = 'none';
            clearInterval(countdownInterval); // Clear interval on new fetch

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const { latitude, longitude } = position.coords;
                        try {
                            const response = await fetch(`https://api.aladhan.com/v1/timings?latitude=${latitude}&longitude=${longitude}&method=11&madhab=2`); // Changed method to 11 (Islamic Foundation, Bangladesh)
                            const data = await response.json();

                            if (data.code === 200 && data.status === 'OK') {
                                const timezoneParts = data.data.meta.timezone.split('/');
                                const locationName = timezoneParts[1] || timezoneParts[0];
                                displayPrayerTimesTable(data.data.timings, locationName);
                                updateNextPrayerAndCountdown(data.data.timings, data.data.meta.timezone, locationName);
                            } else {
                                prayerTimesError.textContent = `Error fetching prayer times by location: ${data.status || 'Unknown error'}. Please check your browser settings or try again.`;
                                prayerTimesError.classList.remove('hidden');
                                nextPrayerSectionElem.style.display = 'none';
                            }
                        } catch (error) {
                            console.error('Failed to fetch prayer times by location:', error);
                            prayerTimesError.textContent = 'Failed to fetch prayer times for your location. Please check your internet connection or try again later.';
                            prayerTimesError.classList.remove('hidden');
                            nextPrayerSectionElem.style.display = 'none';
                        } finally {
                            prayerTimesLoading.classList.add('hidden');
                        }
                    },
                    (error) => {
                        prayerTimesLoading.classList.add('hidden');
                        let errorMessage = 'Geolocation is unavailable or access was denied. Please ensure location services are enabled for your browser/device, or try using a default city (Dhaka).';
                        if (error.code === error.PERMISSION_DENIED) {
                            errorMessage = 'Location access denied. Please enable location services for this site in your browser settings (e.g., Site Settings > Location > Allow).';
                        } else if (error.code === error.POSITION_UNAVAILABLE) {
                            errorMessage = 'Location information is currently unavailable. Your device might not be able to determine your precise location.';
                        } else if (error.code === error.TIMEOUT) {
                            errorMessage = 'The request to get your location timed out. Please try again.';
                        }
                        prayerTimesError.textContent = errorMessage;
                        prayerTimesError.classList.remove('hidden');
                        console.error('Geolocation error:', error);
                        nextPrayerSectionElem.style.display = 'none';
                        // Fallback to default city if geolocation fails prominently
                        getPrayerTimes('Dhaka');
                    }
                );
            } else {
                prayerTimesLoading.classList.add('hidden');
                prayerTimesError.textContent = 'Geolocation is not supported by your browser. Please use a browser that supports location services.';
                prayerTimesError.classList.remove('hidden');
                nextPrayerSectionElem.style.display = 'none';
                // Fallback to default city if geolocation not supported
                getPrayerTimes('Dhaka');
            }
        }

        // Event Listeners for prayer times buttons
        const getLocationBtn = document.getElementById('getLocationBtn'); // Get the button element
        getLocationBtn.addEventListener('click', getUserLocation);

        // Initial Canvas and Prayer Times fetch on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            countdownCanvas = document.getElementById('countdownCanvas');
            ctx = countdownCanvas.getContext('2d');
            // Initial draw for an empty state
            drawCountdownCircle(0, 1, "00:00:00"); // Updated to HH:MM:SS format

            // Call createPaginationDots once after DOM is ready and carousel is rendered
            createPaginationDots();

            // Directly call getUserLocation on load
            getUserLocation();
        });

    </script>
</body>
</html>
